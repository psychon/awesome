-- Configuration file for LuaCov

-- This variable is set externally
local source = '@CMAKE_SOURCE_DIR@'
local binary = '@CMAKE_BINARY_DIR@'
local lib_dir = binary .. '/lib'

local at = '@'
if source == at .. 'CMAKE_SOURCE_DIR' .. at then
    error("This must be run from the build dir, not the source dir")
end

local function escape_pattern(str)
    return string.gsub(str, "%W", "%%%1")
end

return {
    statsfile = binary .. "/luacov.stats.out",

    include = {
        escape_pattern(lib_dir) .. ".+",

        -- For things already having the correct path
        -- (happens with integration tests)
        "^lib/",

        -- For the shape-API auto-generated images
        escape_pattern(source .. "lib/"),
    },

    -- configuration for luacov-coveralls reporter
    coveralls = {
        pathcorrect = {
            { escape_pattern(lib_dir), "lib/"},
            source and { escape_pattern(source .. "lib/"), "lib/" },
        },
    },
}

-- vim: filetype=lua:expandtab:shiftwidth=4:tabstop=8:softtabstop=4:textwidth=80
